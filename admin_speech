import datetime
import sys
import time
import pyttsx3
import speech_recognition as sr
from fuzzywuzzy import fuzz
from pygame import mixer
import webbrowser


# функции
def speak(what):
    print(what)
    speak_engine.say(what)
    speak_engine.runAndWait()
    speak_engine.stop()


speak_engine = pyttsx3.init()

speak("Помни, что сменная обувь нужна всегда и в любое время года")
speak("Аэро слушает")


i = 1
while True:


    # настройки
    opts = {
        "alias": ('аэро', 'aero', 'асситестент',
                  'помощник', 'робот', 'администратор'),
        "tbr": ('скажи', 'расскажи', 'покажи', 'сколько', 'произнеси'),
        "cmds": {
            "comm1": ('Расскажи об  основных курсах кванториума', 'курсы', 'основные курсы'),
            "comm2": ('как правильно заполнить документы', 'заполнение документов'),
            "comm3": ('напомнить, что нужна сменная обувь в любое времмя года', 'сменная обувь', 'запасная обувь'),
            "comm4": ('рассказать о педагогах', 'педагоги'),
            "comm5": ('новости о мероприятиях и как на них записаться', 'мероприятия')
        }
    }





    def callback(recognizer, audio):
        try:
            voice = recognizer.recognize_google(audio, language="ru-RU").lower()
            print("[log] Распознано: " + voice)

            if voice.startswith(opts["alias"]):
                cmd = voice

                for x in opts['alias']:
                    cmd = cmd.replace(x, "").strip()

                for x in opts['tbr']:
                    cmd = cmd.replace(x, "").strip()

                # распознаем и выполняем команду
                cmd = recognize_cmd(cmd)
                execute_cmd(cmd['cmd'])

        except sr.UnknownValueError:
            print("")
        except sr.RequestError as e:
            print("")


    def recognize_cmd(cmd):
        RC = {'cmd': '', 'percent': 0}
        for c, v in opts['cmds'].items():

            for x in v:
                vrt = fuzz.ratio(cmd, x)
                if vrt > RC['percent']:
                    RC['cmd'] = c
                    RC['percent'] = vrt

        return RC





    speak_engine = pyttsx3.init()



    def execute_cmd(cmd):
        if cmd == 'comm1':
            speak('Какое направление вы хотите выбрать промдизайн  айти  авто  промробо  хайтек аэро ')
            voice1 = recognizer.recognize_google(audio, language="ru-RU").lower()
            if voice1 == "промдизайн":
                speak("Какой курс вы хотите выбрать 1 Графический и WEB дизайн 2 Базовый дизайн 3 Перспективный дизайн")
                voice = recognizer.recognize_google(audio, language="ru-RU").lower()
                if voice == "1":
                    speak("Мы взаимодействуем с графикой, когда просто смотрим по сторонам."
                          "Курс будет полезен тем, кто хочет связать свою жизнь с дизайном в различных его проявлениях, а также будущим фотографам или мультипликаторам.")





        elif cmd == 'comm4':
            webbrowser.open('https://robo74.ru/teachers/')



        elif cmd == 'stupid1':
            # рассказать анекдот
            speak("Мой разработчик не научил меня анекдотам ... Ха ха ха\n Аэро слушает")

        elif cmd == 'stupid1':
            # рассказать анекдот
            speak()

        else:
            speak('Команда не распознана, повторите!\nАэро слушает' )


    # запуск
    r = sr.Recognizer()
    m = sr.Microphone(device_index = 1)

    with m as source:
        r.adjust_for_ambient_noise(source)



    stop_listening = r.listen_in_background(m, callback)
    i += 1
